<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="Jevy Wang&#39;s  blog">
<meta name="description" content="Notes ">
<meta name="theme-color" content="#0b7285">
<title>Dockerize conda | Jevy Wang&#39;s Blog</title>
<link rel="shortcut icon" href="/favicon.ico?v=1615161774546">
<link rel="stylesheet" href="/media/css/pisces.css">
<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/default.css"
  rel="stylesheet">

<link rel="stylesheet" href="/styles/main.css">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
  onload="renderMathInElement(document.body);"></script>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-141685300-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-141685300-1');
</script>



  <meta name="description" content="Dockerize conda" />
  <meta name="keywords" content="posts" />
</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="pisces">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>Jevy Wang&#39;s Blog</span>
            </a>  
          
        </div>
        
          <p class="subtitle">Focus</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
            <li class="nav-item ">
              
              
                <a href="https://jevy.wang/" target="_self">
                  <i class="fa fa-globe"></i> Home
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> Tags
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="https://jevy.wang/archives/" target="_self">
                  <i class="fa fa-globe"></i> Timeline
                </a>
              
            </li>
          
            
            
            <li class="nav-item ">
              
              
                <a href="https://jevy.wang/post/about-me/" target="_self">
                  <i class="fa fa-globe"></i> About Me
                </a>
              
            </li>
          
          
          
            <li id="fa_search" class="nav-item">
              <a href="javascript:void(0);">
                <i class="fa fa-search"></i> <span class="language" data-lan="search">搜索</span>
              </a>
            </li>
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout pisces ">
      <div class="section-layout-wrapper">
        

<div class="sidebar">
  
    <div class="sidebar-box box-shadow-wrapper bg-color right-motion" id="sidebar">
      
        <div class="post-list-sidebar">
          <div class="sidebar-title">
            <span id="tocSideBar" class="sidebar-title-item sidebar-title-active language" data-lan="index">文章目录</span>
            <span id="metaSideBar" class="sidebar-title-item language" data-lan="preview">站点概览</span>
          </div>
        </div>
      
      <div class="sidebar-body pisces" id="sidebar_body">
        
          
            <div class="post-side-meta" id="post_side_meta">
              
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">Jevy Wang&#39;s Technical Notes and Blogs</p>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">14</span>
        <span class="site-item-stat-name language" data-lan="article">文章</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">4</span>
        <span class="site-item-stat-name language" data-lan="category">分类</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">4</span>
        <span class="site-item-stat-name language" data-lan="tag">标签</span>
      </a>
    </div>
  </div>
  
    
  
  
    <div class="sidebar-item sidebar-item-social">
      <div class="social-item">
        
          
            <a href="https://github.com/jevy-wangfei">
              <i class="fa fa-github" title="Github"></i>
            </a>
          
        
        
      </div>
    </div>
  

  



</div>
            </div>
            <div class="post-toc sidebar-body-active" id="post_toc" style="opacity: 1;">
              <div class="toc-box right-motion">
  <div class="toc-wrapper auto-number auto"
    id="toc_wrapper">
    <ul class="markdownIt-TOC">
<li><a href="#wrap-conda-into-docker">Wrap conda into docker</a>
<ul>
<li><a href="#prepare-envyml-file">prepare env.yml file</a></li>
<li><a href="#prepare-dockerfile">prepare Dockerfile</a></li>
</ul>
</li>
</ul>

  </div>
</div>

<script>

  let lastTop = 0, lList = [], hList = [], postBody, lastIndex = -1;
  let active = 'active-show', activeClass = 'active-current';
  let tocWrapper = document.querySelector('#toc_wrapper');
  let tocContent = tocWrapper.children[0];
  let autoNumber = tocWrapper && tocWrapper.classList.contains('auto-number');

  function addTocNumber(elem, deep) {
    if (!elem) {
      return;
    }
    let prop = elem.__proto__;

    if (prop === HTMLUListElement.prototype) {
      for (let i = 0; i < elem.children.length; i++) {
        addTocNumber(elem.children[i], deep + (i + 1) + '.');
      }
    } else if (prop === HTMLLIElement.prototype) {
      // 保存li元素
      if (elem.children[0] && elem.children[0].__proto__ === HTMLAnchorElement.prototype) {
        lList.push(elem);
      }
      for (let i = 0; i < elem.children.length; i++) {
        let cur = elem.children[i];
        if (cur.__proto__ === HTMLAnchorElement.prototype) {
          if (autoNumber) {
            cur.text = deep + ' ' + cur.text;
          }
        } else if (cur.__proto__ === HTMLUListElement.prototype) {
          addTocNumber(cur, deep);
        }
      }
    }
  }

  function removeParentActiveClass() {
    let parents = tocContent.querySelectorAll('.' + active)
    parents.forEach(function (elem) {
      elem.classList.remove(active);
    });
  }

  function addActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.add(activeClass);
    }
  }

  function removeActiveClass(index) {
    if (index >= 0 && index < hList.length) {
      lList[index].classList.remove(activeClass);
    }
  }

  function addActiveLiElemment(elem, parent) {
    if (!elem || elem === parent) {
      return;
    } else {
      if (elem.__proto__ === HTMLLIElement.prototype) {
        elem.classList.add(active);
      }
      addActiveLiElemment(elem.parentElement, parent);
    }
  }

  function showToc() {
    if (tocWrapper) {
      postBody = document.querySelector('#post_body');
      for (let i = 0; i < postBody.children.length; i++) {
        if (postBody.children[i].__proto__ === HTMLHeadingElement.prototype) {
          hList.push(postBody.children[i]);
        }
      }
      if (tocWrapper.classList.contains('compress')) {
        tocContent.classList.add('closed');
      } else if (tocWrapper.classList.contains('no_compress')) {
        tocContent.classList.add('expanded');
      } else {
        if (hList.length > 10) {
          active = 'active-hidden'
          tocContent.classList.add('closed');
        } else {
          tocContent.classList.add('expanded');
        }
      }
    }
  }

  (function () {
    // 处理不是从#一级标题开始目录
    if (tocContent.children.length === 1 && tocContent.children[0].__proto__ === HTMLLIElement.prototype) {
      let con = tocContent.children[0].children[0];
      tocContent.innerHTML = con.innerHTML;
    }
    let markdownItTOC = document.querySelector('.markdownIt-TOC');
    let innerHeight = window.innerHeight;
    markdownItTOC.style = `max-height: ${innerHeight - 80 > 0 ? innerHeight - 80 : innerHeight}px`
    addTocNumber(tocContent, '');
  })();

  document.addEventListener('scroll', function (e) {
    if (lList.length <= 0) {
      return;
    }
    let scrollTop = document.scrollingElement.scrollTop + 10;
    let dir;

    if (lastTop - scrollTop > 0) {
      dir = 'up';
    } else {
      dir = 'down';
    }

    lastTop = scrollTop;
    if (scrollTop <= 0) {
      if (lastIndex >= 0 && lastIndex < hList.length) {
        lList[lastIndex].classList.remove(activeClass);
      }
      return;
    }

    let current = 0, hasFind = false;
    for (let i = 0; i < hList.length; i++) {
      if (hList[i].offsetTop > scrollTop) {
        current = i;
        hasFind = true;
        break;
      }
    }
    if (!hasFind && scrollTop > lList[lList.length - 1].offsetTop) {
      current = hList.length - 1;
    } else {
      current--;
    }
    if (dir === 'down') {
      if (current > lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex)
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    } else {
      if (current < lastIndex) {
        addActiveClass(current);
        removeActiveClass(lastIndex);
        lastIndex = current;
        removeParentActiveClass();
        lList[current] && addActiveLiElemment(lList[current].parentElement, tocContent);
      }
    }
  });


  window.addEventListener('load', function () {
    showToc();
    document.querySelector('#sidebar').style = 'display: block;';
    tocWrapper.classList.add('toc-active');
    setTimeout(function () {
      if ("createEvent" in document) {
        let evt = document.createEvent("HTMLEvents");
        evt.initEvent("scroll", false, true);
        document.dispatchEvent(evt);
      }
      else {
        document.fireEvent("scroll");
      }
    }, 500)
  })

</script>
            </div>
          
        
      </div>
    </div>
  
</div>
<script>
  const SIDEBAR_TITLE_ACTIVE = 'sidebar-title-active';
  const SIDEBAR_BODY_ACTIVE = 'sidebar-body-active';
  const SLIDE_UP_IN = 'slide-up-in';

  let sidebar = document.querySelector('#sidebar'),
  tocSideBar = document.querySelector('#tocSideBar'),
  metaSideBar = document.querySelector('#metaSideBar'),
  postToc = document.querySelector('#post_toc'),
  postSiteMeta = document.querySelector('#post_side_meta'),
  sidebarTitle = document.querySelector('.sidebar-title'),
  sidebarBody = document.querySelector('#sidebar_body');

  tocSideBar && tocSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  metaSideBar && metaSideBar.addEventListener('click', (e) => {
    toggleSidebar(e);
  });

  function toggleSidebar(e) {
    let currentTitle = document.querySelector("."+SIDEBAR_TITLE_ACTIVE);
    if (currentTitle == e.srcElement) {
      return ;
    }
    let current, showElement, hideElement;
    if (e.srcElement == metaSideBar) {
      showElement = postSiteMeta;
      hideElement = postToc;
    } else if (e.srcElement == tocSideBar){
      showElement = postToc;
      hideElement = postSiteMeta;
    }
    currentTitle.classList.remove(SIDEBAR_TITLE_ACTIVE);
    e.srcElement.classList.add(SIDEBAR_TITLE_ACTIVE);

    window.Velocity(hideElement, 'stop');
    window.Velocity(hideElement, 'transition.slideUpOut', {
      display: 'none',
      duration: 200,
      complete: function () {
        window.Velocity(showElement, 'transition.slideDownIn', {
          duration: 200
        });
      }
    })
    hideElement.classList.remove(SIDEBAR_BODY_ACTIVE);
    showElement.classList.add(SIDEBAR_BODY_ACTIVE);
  }

  postToc && postToc.addEventListener('transitionend', function() {
    this.classList.remove(SLIDE_UP_IN);
  });

  if (sidebarBody) {
    if (sidebarBody.classList.contains('pisces') || sidebarBody.classList.contains('gemini')) {
      let hasFix = false;
      let scrollEl = document.querySelector('.main-continer');
      let limitTop = document.querySelector('#nav_ul').children.length * 42 + 162;
      window.addEventListener('scroll', function(e) {
        if (document.scrollingElement.scrollTop >= limitTop) {
          if (!hasFix) {
            sidebar.classList.add('sidebar-fixed');
            hasFix = true;
          }
        } else {
          if (hasFix) {
            sidebar.classList.remove('sidebar-fixed');
            hasFix = false;
          }
        }
      });
    }
  }
  
</script>
        <div class="section-box box-shadow-wrapper">
          <div class="section bg-color post post-page">
            <section class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://jevy.wang/post/2021-02-23-i-post-dockerize-conda/">
      Dockerize conda
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span class="language" data-lan="publish">发布于</span>
      <span class="publish-time" data-t="2021-02-23 09:00:00">2021-02-23</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show language" data-lan="category-in">分类于</span>
      
      
      <a href="https://jevy.wang/tag/Y7_0cI8uj/">
        <span>posts</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>1<span class="language" data-lan="minute">分钟</span></span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>146<span class="pc-show language" data-lan="words">字数</span></span>
    </span>
    
  </div>
</section>
            <div class="post-body next-md-body" id="post_body">
              <h1 id="wrap-conda-into-docker">Wrap conda into docker</h1>
<h2 id="prepare-envyml-file">prepare env.yml file</h2>
<pre><code class="language-json">name: test
channels:
  - conda-forge
dependencies:
  - flask
</code></pre>
<h2 id="prepare-dockerfile">prepare Dockerfile</h2>
<pre><code>FROM continuumio/miniconda3

WORKDIR /conda

# Create conda env using env.yml:
COPY env.yml .
RUN conda env create -f env.yml

# Should activate the conda env test here, but execute conda activate test will throw an error:  conda init is required

# This code does not help too
# RUN source ~/minikube/etc/profile.d/conda.sh
# RUN conda activate test

# That is because every new step of docker build, a new shell will be startup. 
# The new shell would not know where is conda

# This would also cause problem when executing the docker as another new shell will be created

COPY . .

# Here is the solution 
ENTRYPOINT [&quot;conda&quot;, &quot;run&quot;, &quot;--no-capture-output&quot;, &quot;-n&quot;, &quot;test&quot;, &quot;python&quot;, &quot;other_code.py&quot;]
</code></pre>

            </div>
            
            
              <div class="post-footer">
  <ul class="post-copyright">
    <li class="post-copyright-author">
      <strong class="language" data-lan="author">本文作者：</strong>
      Jevy Wang&#39;s Technical Notes and Blogs
    </li>
    <li class="post-copyright-link">
      <strong class="language" data-lan="link">本文链接：</strong>
      <a href="https://jevy.wang/post/2021-02-23-i-post-dockerize-conda/" title="Dockerize conda">https://jevy.wang/post/2021-02-23-i-post-dockerize-conda/</a>
    </li>
    <li class="post-copyright-license">
      <strong class="language" data-lan="copyright">版权声明： </strong>
      本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！
    </li>
  </ul>
  <div class="tags">
    
      <a href="https://jevy.wang/tag/Y7_0cI8uj/"># posts</a>
    
  </div>
  <div class="nav">
    <div class="nav-prev">
      
    </div>
    <div class="nav-next">
      
        <a class="nav-pc-next" title="Panel serve to public" href="https://jevy.wang/post/2021-02-23-i-post-panel-serve-to-public/">Panel serve to public</a>
        <a class="nav-mobile-next" title="Panel serve to public" href="https://jevy.wang/post/2021-02-23-i-post-panel-serve-to-public/">下一篇</a>
        <i class="fa fa-chevron-right"></i>
      
    </div>
  </div>
</div>
            
            
  

          </div>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | © 2019-2020 Theme By <a
        href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
  </footer>
  
  
  <div class="pisces back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
    <span class="scrollpercent">
      <span id="back_to_top_text">0</span>%
    </span>
    
  </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
    back2TopText = document.querySelector('#back_to_top_text'),
    drawerBox = document.querySelector('#drawer_box'),
    rightSideBar = document.querySelector('.sidebar'),
    viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {

    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function (e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });

  window.addEventListener('scroll', function (e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });


  let hasCacu = false;
  window.onresize = function () {
    calcuHeight();
  }

  function calcuHeight() {
    // 动态调整站点概览高度
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();

  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function () {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function () {
            window.Velocity(rightMotions, transitionDir, {});
          }
        })
        window.Velocity(viewport, openProp, {
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function () {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp, {
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // 链接跳转
  let newWindow = 'false'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target", "_blank");
      }
    })
  }

  let faSearch = document.querySelector('#fa_search');
  faSearch.addEventListener('click', function () {
    document.querySelector('#search_mask').style = ''
  })

  // 代码高亮
  hljs.initHighlightingOnLoad();
  
  // 离开当前页title变化
  var leaveTitle = "";
  if (leaveTitle) {
    document.addEventListener('visibilitychange', function () {
      if (document.visibilityState == 'hidden') {
        normal_title = document.title;
        document.title = leaveTitle;
      } else {
        document.title = normal_title;
      }
    });
  }

</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script>
  let images = document.querySelectorAll('.section img');
  console.log(images);
  images.forEach(image => {
    var parent = image.parentElement;
    var next = image.nextElementSibling;
    parent.removeChild(image);
    var aelem = document.createElement('a');
    aelem.href = image.src;
    aelem.dataset['fancybox'] = 'images';
    aelem.dataset['rel'] = 'fancybox-button';
    aelem.classList.add('fancybox');
    aelem.appendChild(image);
    parent.insertBefore(aelem, next);
  })
</script>
    <div class="reward-mask" style="display: none;">
  <div class="reward-relative">
    <span class="close" aria-hidden="true">x</span>
    <div class="reward-body">
      <h2>感谢您的支持，我会继续努力的!</h2>
      <div class="reward-img-box">
        <div style="position: relative; width: 140px; height: 140px;">
          
          
          
        </div>
      </div>
      <p class="reward-word">扫码打赏，你说多少就多少</p>
      <p class="reward-tip">打开微信扫一扫，即可进行扫码打赏哦</p>
    </div>
    <div class="bottom">
      
      
    </div>
  </div>
</div>
<style>
  .reward-mask {
    position: fixed;
    z-index: 99999;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: #00000054;
  }

  .reward-relative {
    position: relative;
    width: 480px;
    text-align: center;
    margin: 0 auto;
    border-radius: 5px;
    background-color: #fff;
    top: 50%;
    margin-top: -205px;
  }

  .reward-relative .close {
    position: absolute;
    right: 10px;
    font-weight: normal;
    font-size: 16px;
    color: #929292;
  }

  .reward-body {
    padding: 40px 20px 20px;
  }

  .bottom {
    display: flex;
  }

  .reward-btn {
    text-align: center;
  }

  .reward-btn-text {
    display: inline-block;
    cursor: pointer;
    width: 60px;
    height: 60px;
    line-height: 60px;
    border-radius: 50%;
    background-color: #ff9734;
    color: #FFF;
    margin-top: 20px;
  }

  .pay-text {
    margin-top: 10px;
    padding: 10px;
    flex: 1;
    transition: all .2s linear;
  }

  .pay-text:hover {
    background-color: #a5a5a536;
  }

  .reward-body h2 {
    padding-top: 10px;
    text-align: center;
    color: #a3a3a3;
    font-size: 16px;
    font-weight: normal;
    margin: 0 0 20px;
  }

  .reward-body h2:after,
  .reward-body h2:before {
    font-family: Arial, Helvetica, sans-serif;
    background: 0 0;
    width: 0;
    height: 0;
    font-style: normal;
    color: #eee;
    font-size: 80px;
    position: absolute;
    top: 20px;
  }

  .reward-body h2:before {
    content: '\201c';
    left: 50px;
  }

  .reward-body h2:after {
    content: '\201d';
    right: 80px;
  }

  .reward-img-box {
    display: inline-block;
    padding: 10px;
    border: 6px solid #ea5f00;
    margin: 0 auto;
    border-radius: 3px;
    position: relative;
  }

  .reward-img {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
  }

  @media (max-width: 767px) {
    .reward-relative {
      height: 100%;
      top: 0px;
      margin-top: 0;
      width: auto;
    }

    .reward-relative .bottom {
      flex-direction: column;
    }

    .reward-relative .pay-text {
      width: 80%;
      margin: 5px auto;
      border: 1px solid silver;
      padding: 6px;
      border-radius: 4px;
    }

    .reward-body h2:after {
      right: 40px;
    }

    .reward-body h2:after,
    .reward-body h2:before {
      font-size: 60px;
    }

    .reward-body h2:before {
      left: 20px;
    }
  }
</style>
<script>
  !function () {
    var mask = document.querySelector('.reward-mask');
    let close = document.querySelector('.reward-relative .close');
    let rewardBtn = document.querySelector('.reward-btn');

    let zfb = document.querySelector('#zfb'),
      wx = document.querySelector('#wx'),
      zfbBtn = document.querySelector('#zfbBtn'),
      wxBtn = document.querySelector('#wxBtn');

    if (zfbBtn && wxBtn) {
      zfbBtn.addEventListener('click', () => {
        window.Velocity(zfb, 'transition.slideLeftIn', {
          duration: 400
        });
        window.Velocity(wx, 'transition.slideRightOut', {
          display: 'none',
          duration: 400
        });
      });

      wxBtn.addEventListener('click', () => {
        window.Velocity(wx, 'transition.slideRightIn', {
          duration: 400
        });
        window.Velocity(zfb, 'transition.slideLeftOut', {
          display: 'none',
          duration: 400
        });
      });
    }

    rewardBtn.addEventListener('click', (e) => {
      window.Velocity(mask, 'transition.slideDownIn', {
        duration: 400
      })
    });

    close.addEventListener('click', (e) => {
      e.preventDefault();
      window.Velocity(mask, 'transition.slideUpOut', {
        duration: 400
      })
    })
  }()
</script>

  </div>
</body>

<div class="search-mask" id="search_mask" style="display: none;">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input id="search" type="text" class="language" data-lan="search" placeholder="搜索">
      </div>
      <i id="close" class="fa fa-times-circle"></i>
    </div>
    <div class="stat-box">
      <span id="stat_count">0</span><span class="language" data-lan="stat">条相关条目，使用了</span><span id="stat_times">0</span><span class="language" data-lan="stat-time">毫秒</span>
      <hr>
    </div>
    <div class="result" id="result">
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2021-02-23-i-post-dockerize-conda/"" data-c="
          &lt;h1 id=&#34;wrap-conda-into-docker&#34;&gt;Wrap conda into docker&lt;/h1&gt;
&lt;h2 id=&#34;prepare-envyml-file&#34;&gt;prepare env.yml file&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;name: test
channels:
  - conda-forge
dependencies:
  - flask
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;prepare-dockerfile&#34;&gt;prepare Dockerfile&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;FROM continuumio/miniconda3

WORKDIR /conda

# Create conda env using env.yml:
COPY env.yml .
RUN conda env create -f env.yml

# Should activate the conda env test here, but execute conda activate test will throw an error:  conda init is required

# This code does not help too
# RUN source ~/minikube/etc/profile.d/conda.sh
# RUN conda activate test

# That is because every new step of docker build, a new shell will be startup. 
# The new shell would not know where is conda

# This would also cause problem when executing the docker as another new shell will be created

COPY . .

# Here is the solution 
ENTRYPOINT [&amp;quot;conda&amp;quot;, &amp;quot;run&amp;quot;, &amp;quot;--no-capture-output&amp;quot;, &amp;quot;-n&amp;quot;, &amp;quot;test&amp;quot;, &amp;quot;python&amp;quot;, &amp;quot;other_code.py&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;
">Dockerize conda</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2021-02-23-i-post-panel-serve-to-public/"" data-c="
          &lt;h1 id=&#34;panel-serve-options&#34;&gt;panel serve options&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# The pn.serve accepts a number of arguments: [source](https://docs.bokeh.org/en/latest/docs/reference/server/server.html#bokeh.server.server.Server)

class Serve(Subcommand):
    &#39;&#39;&#39; Subcommand to launch the Bokeh server.
    &#39;&#39;&#39;

    #: name for this subcommand
    name = &amp;quot;serve&amp;quot;

    help = &amp;quot;Run a Bokeh server hosting one or more applications&amp;quot;

    args = base_serve_args + (
        (&#39;files&#39;, dict(
            metavar = &#39;DIRECTORY-OR-SCRIPT&#39;,
            nargs   = &#39;*&#39;,
            help    = &amp;quot;The app directories or scripts to serve (serve empty document if not specified)&amp;quot;,
            default = None,
        )),

        (&#39;--args&#39;, dict(
            metavar = &#39;COMMAND-LINE-ARGS&#39;,
            nargs   = argparse.REMAINDER,
            help    = &amp;quot;Command line arguments remaining to passed on to the application handler. &amp;quot;
                      &amp;quot;NOTE: if this argument precedes DIRECTORY-OR-SCRIPT then some other argument, e.g. &amp;quot;
                      &amp;quot;--show, must be placed before the directory or script. &amp;quot;,
        )),

        (&#39;--dev&#39;, dict(
            metavar =&#39;FILES-TO-WATCH&#39;,
            action  =&#39;store&#39;,
            default = None,
            type    = str,
            nargs   = &#39;*&#39;,
            help    = &amp;quot;Enable live reloading during app development. &amp;quot;
                      &amp;quot;By default it watches all *.py *.html *.css *.yaml files &amp;quot;
                      &amp;quot;in the app directory tree. Additional files can be passed &amp;quot;
                      &amp;quot;as arguments. &amp;quot;
                      &amp;quot;NOTE: if this argument precedes DIRECTORY-OR-SCRIPT then some other argument, e.g &amp;quot;
                      &amp;quot;--show, must be placed before the directory or script. &amp;quot;
                      &amp;quot;NOTE: This setting only works with a single app. &amp;quot;
                      &amp;quot;It also restricts the number of processes to 1. &amp;quot;
                      &amp;quot;NOTE FOR WINDOWS USERS : this option must be invoked using &amp;quot;
                      &amp;quot;&#39;python -m bokeh&#39;. If not Tornado will fail to restart the &amp;quot;
                      &amp;quot;server&amp;quot;,
        )),

        (&#39;--show&#39;, dict(
            action = &#39;store_true&#39;,
            help   = &amp;quot;Open server app(s) in a browser&amp;quot;,
        )),

        (&#39;--allow-websocket-origin&#39;, dict(
            metavar = &#39;HOST[:PORT]&#39;,
            action  = &#39;append&#39;,
            type    = str,
            help    = &amp;quot;Public hostnames which may connect to the Bokeh websocket&amp;quot;,
        )),

        (&#39;--prefix&#39;, dict(
            metavar = &#39;PREFIX&#39;,
            type    = str,
            help    = &amp;quot;URL prefix for Bokeh server URLs&amp;quot;,
            default = None,
        )),

        (&#39;--keep-alive&#39;, dict(
            metavar = &#39;MILLISECONDS&#39;,
            type    = int,
            help    = &amp;quot;How often to send a keep-alive ping to clients, 0 to disable.&amp;quot;,
            default = None,
        )),

        (&#39;--check-unused-sessions&#39;, dict(
            metavar = &#39;MILLISECONDS&#39;,
            type    = int,
            help    = &amp;quot;How often to check for unused sessions&amp;quot;,
            default = None,
        )),

        (&#39;--unused-session-lifetime&#39;, dict(
            metavar = &#39;MILLISECONDS&#39;,
            type    = int,
            help    = &amp;quot;How long unused sessions last&amp;quot;,
            default = None,
        )),

        (&#39;--stats-log-frequency&#39;, dict(
            metavar = &#39;MILLISECONDS&#39;,
            type    = int,
            help    = &amp;quot;How often to log stats&amp;quot;,
            default = None,
        )),

        (&#39;--mem-log-frequency&#39;, dict(
            metavar = &#39;MILLISECONDS&#39;,
            type    = int,
            help    = &amp;quot;How often to log memory usage information&amp;quot;,
            default = None,
        )),

        (&#39;--use-xheaders&#39;, dict(
            action = &#39;store_true&#39;,
            help   = &amp;quot;Prefer X-headers for IP/protocol information&amp;quot;,
        )),

        (&#39;--ssl-certfile&#39;, dict(
            metavar = &#39;CERTFILE&#39;,
            action  = &#39;store&#39;,
            default = None,
            help    = &#39;Absolute path to a certificate file for SSL termination&#39;,
        )),

        (&#39;--ssl-keyfile&#39;, dict(
            metavar = &#39;KEYFILE&#39;,
            action  = &#39;store&#39;,
            default = None,
            help    = &#39;Absolute path to a private key file for SSL termination&#39;,
        )),

        (&#39;--session-ids&#39;, dict(
            metavar = &#39;MODE&#39;,
            action  = &#39;store&#39;,
            default = None,
            choices = SESSION_ID_MODES,
            help    = &amp;quot;One of: %s&amp;quot; % nice_join(SESSION_ID_MODES),
        )),

        (&#39;--auth-module&#39;, dict(
            metavar = &#39;AUTH_MODULE&#39;,
            action  = &#39;store&#39;,
            default = None,
            help    = &#39;Absolute path to a Python module that implements auth hooks&#39;,
        )),

        (&#39;--enable-xsrf-cookies&#39;, dict(
            action  = &#39;store_true&#39;,
            default = False,
            help    = &#39;Whether to enable Tornado support for XSRF cookies. All &#39;
                      &#39;PUT, POST, or DELETE handlers must be properly instrumented &#39;
                      &#39;when this setting is enabled.&#39;
        )),

        (&#39;--exclude-headers&#39;, dict(
            action  = &#39;store&#39;,
            default = None,
            nargs=&#39;+&#39;,
            help    = &#39;A list of request headers to exclude from the session &#39;
                      &#39;context (by default all headers are included).&#39;
        )),

        (&#39;--exclude-cookies&#39;, dict(
            action  = &#39;store&#39;,
            default = None,
            nargs=&#39;+&#39;,
            help    = &#39;A list of request cookies to exclude from the session &#39;
                      &#39;context (by default all cookies are included).&#39;
        )),

        (&#39;--include-headers&#39;, dict(
            action  = &#39;store&#39;,
            default = None,
            nargs=&#39;+&#39;,
            help    = &#39;A list of request headers to make available in the session &#39;
                      &#39;context (by default all headers are included).&#39;
        )),

        (&#39;--include-cookies&#39;, dict(
            action  = &#39;store&#39;,
            default = None,
            nargs=&#39;+&#39;,
            help    = &#39;A list of request cookies to make available in the session &#39;
                      &#39;context (by default all cookies are included).&#39;
        )),

        (&#39;--cookie-secret&#39;, dict(
            metavar = &#39;COOKIE_SECRET&#39;,
            action  = &#39;store&#39;,
            default = None,
            help    = &#39;Configure to enable getting/setting secure cookies&#39;,
        )),

        (&#39;--index&#39;, dict(
            metavar = &#39;INDEX&#39;,
            action  = &#39;store&#39;,
            default = None,
            help    = &#39;Path to a template to use for the site index&#39;,
        )),

        (&#39;--disable-index&#39;, dict(
            action = &#39;store_true&#39;,
            help   = &#39;Do not use the default index on the root path&#39;,
        )),

        (&#39;--disable-index-redirect&#39;, dict(
            action = &#39;store_true&#39;,
            help   = &#39;Do not redirect to running app from root path&#39;,
        )),

        (&#39;--num-procs&#39;, dict(
            metavar = &#39;N&#39;,
            action  = &#39;store&#39;,
            help    = &amp;quot;Number of worker processes for an app. Using &amp;quot;
                      &amp;quot;0 will autodetect number of cores (defaults to 1)&amp;quot;,
            default = 1,
            type    = int,
        )),

        (&#39;--session-token-expiration&#39;, dict(
            metavar = &#39;N&#39;,
            action  = &#39;store&#39;,
            help    = &amp;quot;Duration in seconds that a new session token &amp;quot;
                      &amp;quot;is valid for session creation. After the expiry &amp;quot;
                      &amp;quot;time has elapsed, the token will not be able &amp;quot;
                      &amp;quot;create a new session (defaults to  seconds).&amp;quot;,
            default = DEFAULT_SESSION_TOKEN_EXPIRATION,
            type    = int,
        )),

        (&#39;--websocket-max-message-size&#39;, dict(
            metavar = &#39;BYTES&#39;,
            action  = &#39;store&#39;,
            help    = &amp;quot;Set the Tornado websocket_max_message_size value &amp;quot;
                      &amp;quot;(default: 20MB)&amp;quot;,
            default = DEFAULT_WEBSOCKET_MAX_MESSAGE_SIZE_BYTES,
            type    = int,
        )),

        (&#39;--websocket-compression-level&#39;, dict(
            metavar = &#39;LEVEL&#39;,
            action  = &#39;store&#39;,
            help    = &amp;quot;Set the Tornado WebSocket compression_level&amp;quot;,
            default = None,
            type    = int,
        )),

        (&#39;--websocket-compression-mem-level&#39;, dict(
            metavar = &#39;LEVEL&#39;,
            action  = &#39;store&#39;,
            help    = &amp;quot;Set the Tornado WebSocket compression mem_level&amp;quot;,
            default = None,
            type    = int,
        )),

        (&#39;--glob&#39;, dict(
            action=&#39;store_true&#39;,
            help=&#39;Process all filename arguments as globs&#39;,
        )),
    )
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;address-serve-as-public-ip-address&#34;&gt;address - serve as public ip address&lt;/h2&gt;
&lt;p&gt;setting the address=public ip, bokeh server will listen on this ip address. bokeh client could get the js script includes this public ip, which will be used for further bokeh js download and socket setup&lt;/p&gt;
&lt;h2 id=&#34;-allow-websocket-origin&#34;&gt;--allow-websocket-origin&lt;/h2&gt;
&lt;p&gt;The origin URLs can access the bokeh server. 403 will be returned for unlisted URLs.&lt;br&gt;
&amp;quot;*&amp;quot; can be set to allow any origin.&lt;/p&gt;
">Panel serve to public</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2021-02-23-i-post-panel-serve/"" data-c="
          &lt;h1 id=&#34;relationship-between-panel-holoviews-and-bokeh&#34;&gt;Relationship between panel, holoviews, and bokeh&lt;/h1&gt;
&lt;p&gt;The HoloViews pane renders HoloViews plots with one of the plotting backends supported by HoloViews. It supports the regular HoloViews widgets for exploring the key dimensions of a HoloMap or DynamicMap, but is more flexible than the native HoloViews widgets since it also allows customizing widget types and their position relative to the plot. &lt;a href=&#34;https://panel.holoviz.org/reference/panes/HoloViews.html&#34;&gt;source&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;HoloViews supports backends: &#39;bokeh&#39;, &#39;matplotlib&#39;, or &#39;plotly&#39;&lt;/p&gt;
&lt;h1 id=&#34;serve-panel&#34;&gt;Serve panel&lt;/h1&gt;
&lt;h2 id=&#34;two-ways-of-serving-panel&#34;&gt;Two ways of serving panel&lt;/h2&gt;
&lt;h3 id=&#34;servable-and-panel-serve-pyipynb&#34;&gt;.servable() and panel serve **.py/ipynb&lt;/h3&gt;
&lt;p&gt;Any .py or .ipynb file that attaches a plot to Bokeh&#39;s curdoc can be deployed using panel serve. The easiest way to do this is using wrapping the HoloViews component in Panel using pn.panel(hvobj) and then calling the panel_obj.servable() method, which accepts any HoloViews object ensures that the plot is discoverable by Panel and the underlying Bokeh server. &lt;a href=&#34;http://holoviews.org/user_guide/Deploying_Bokeh_Apps.html&#34;&gt;source&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# Serve .py or .ipynb file
panel serve --allow-websocket-origin=localhost:3000 --address=localhost --port=5006 **.py
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# Serve .py or .ipynb file within Flask using Threading in different ports
def services():
    thread_pool = []
    # json_files is a json configration, which includes multiple config sections
    for json_file in json_files:
        comm = f&#39;panel serve --allow-websocket-origin=localhost:3000 --address=localhost --port={str(json_file[&amp;quot;file_port&amp;quot;])}{json_file[&amp;quot;file_path&amp;quot;]}&#39;
        thread_pool.append(comm)
    return thread_pool

# Run threads
for comm in services():
    Thread(target=os.system, args=(comm,)).start() 
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;pnserve&#34;&gt;pn.serve()&lt;/h3&gt;
&lt;p&gt;When using pn.serve all sessions will share the same state, and may cause a problem that a client&#39;s activity may affect other clients. Therefore it is best to wrap the creation of the app in a function which we can then provide to pn.serve. For example:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;xarray_dataset =  xr.open_dataset(&amp;quot;**.nc&amp;quot;)

def plot(xarray_dataset):
    image = ds_grouped_ndvi.hvplot(&#39;x&#39;, &#39;y&#39;).opts(cmap=&#39;RdYlGn&#39;)
    stream = hv.streams.Tap(source=image, x=104, y=10)
    @pn.depends(stream.param.x, stream.param.y)
    def timeseries(x, y):
        return xarray_dataset.sel(x=x, y=y, method=&#39;nearest&#39;).hvplot(&#39;time&#39;)
    return pn.Column(image, timeseries)

# This would cause sharing state issue
pn.serve(plot(xarray_dataset))

def serve_func():
    return plot(xarray_dataset)
# Because serving a function, every call will create a new function, and further new panel layout
pn.serve(result_func)
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;access-panel-service-in-url&#34;&gt;Access panel service in URL&lt;/h1&gt;
&lt;h2 id=&#34;pull_session-and-server_session&#34;&gt;pull_session() and server_session()&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from bokeh.client import pull_session
from bokeh.embed import server_session
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;pull_session() method at bokeh.client.session will not work for large socket message size. A config will exposed at bokeh 2.3.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# FastAPI example
@app.get(&amp;quot;/test&amp;quot;)
def getViewByName(request: Request, ):
    url = &#39;http://localhost:5006&#39;
    with pull_session(url=url) as session:
        script = server_session(session_id=session.id, url=url)
    return templates.TemplateResponse(&#39;embed_div.html&#39;, context={&#39;request&#39;: request, &#39;script&#39;: script})

&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;server_document&#34;&gt;server_document()&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;from bokeh.embed import server_document
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;# FastAPI example
@app.get(&amp;quot;/test4&amp;quot;)
def getViewByName(request: Request, ):
    url = &#39;http://localhost:5008&#39;
    script = server_document(url)
    return templates.TemplateResponse(&#39;embed_div.html&#39;, context={&#39;request&#39;: request, &#39;script&#39;: script})
&lt;/code&gt;&lt;/pre&gt;
">Panel serve</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2021-02-23-i-post-tips-using-azure/"" data-c="
          &lt;h1 id=&#34;monitoring-config&#34;&gt;Monitoring Config&lt;/h1&gt;
&lt;p&gt;Azure Application insight has sampling feature (default enable) that will randomly ignore some of logs when it exceeds a specified threshold (unknown the threshold).&lt;br&gt;
The Azure function monitoring tracking could tell you the failure or success by inspecting the log. The sampling feature would cause the problem of not telling you the result of function execution. &lt;a href=&#34;https://docs.microsoft.com/en-us/azure/azure-functions/configure-monitoring?tabs=v2#configure-sampling&#34;&gt;source&lt;/a&gt;&lt;br&gt;
Adding following config at Azure function host.json to disable it:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
  &amp;quot;logging&amp;quot;: {
    &amp;quot;applicationInsights&amp;quot;: {
      &amp;quot;samplingSettings&amp;quot;: {
        &amp;quot;isEnabled&amp;quot;: false,
        &amp;quot;maxTelemetryItemsPerSecond&amp;quot; : 20,
        &amp;quot;excludedTypes&amp;quot;: &amp;quot;Request;Exception&amp;quot;
      }
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;azure-function&#34;&gt;Azure Function&lt;/h1&gt;
&lt;h2 id=&#34;shared&#34;&gt;Shared&lt;/h2&gt;
&lt;p&gt;Because many functions (may not only yours) share computing resources, there are some limitations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Multiple functions within a Azure function application may clash&lt;/li&gt;
&lt;li&gt;There are many Azure defined limitations such as Threads, processes, connections, sockets, etc. &lt;a href=&#34;https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox#app-service-plans-and-sandbox-limits&#34;&gt;source&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;webapp&#34;&gt;webapp&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;So far so good, need pay higher fees. Didn&#39;t see values comparing with VMs.&lt;/li&gt;
&lt;/ul&gt;
">Tips of using Azure</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2019-02-28-i-post-package-aws-lambda/"" data-c="
          &lt;ul&gt;
&lt;li&gt;Install/start Docker&lt;/li&gt;
&lt;li&gt;Install python3&lt;/li&gt;
&lt;li&gt;Install nodejs (npm included)&lt;/li&gt;
&lt;li&gt;Install serverless: npm install -g serverless&lt;/li&gt;
&lt;li&gt;Install virtualenv of python pip install virtualenv&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;p&gt;Create Serverless project&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;serverless create   --template aws-python3  --name project-name  --path project-path
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Active virtualenv at project directory:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;virtualenv venv --python=python3
# On Windows
.\venv\Script\activate
# On Linux
source venv/bin/activate
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Install python package and code as usual in python virtual environment&lt;/p&gt;
&lt;p&gt;Freeze python package to requirements.txt&lt;br&gt;
&lt;code&gt;pip freeze &amp;gt; requirements.txt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Install &lt;code&gt;serverless-python-requirements&lt;/code&gt; and config the plugin at serverless.yml&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;npm install --save serverless-python-requirements
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;service: project-name # NOTE: update this with your service name
provider:
  name: aws
  runtime: python3.6
  region: aws-reagon
  role: aws-iam-role-with-the-privilidge-to-create-lambda-function
plugins:
  - serverless-python-requirements
# you can add packaging information here
package:
  exclude:
     - vent/**

functions:
  hello:
    handler: handler.hello
    events:
      - http:
          path: hello
          method: get
          cors: true
          integration: LAMBDA
      - schedule: rate(1 hour)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Deploy to AWS:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- more --&amp;gt;

serverless deploy

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Useful tools:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;serverless logs --function hello #check last log&lt;/li&gt;
&lt;li&gt;serverless invoke -f hello --log #invoke the function&lt;/li&gt;
&lt;/ul&gt;
">Package AWS Lambda function</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2020-02-28-i-post-ip-camera-hacking/"" data-c="
          &lt;p&gt;Got a Solar WiFi IP camera from &lt;a href=&#34;https://www.ebay.com.au/itm/302918525683?ul_noapp=true&#34;&gt;Wireless Solar IP67 Security Camera System Outdoor Home Cam 1080P 2MP&lt;/a&gt;&lt;br&gt;
Wondering to control this camera using script/program.&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;To activate/wakeup, the camera has to be set correctly:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The camera is connected to the Internet, and its status should be shown as ‘online’ on Microshare, Danale mobile client.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Active the camera using python script:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import socket, sys
import binascii
dest = (&#39;camera ip address&#39;, &#39;any port)
# sending these hex code  in UDP protocal to active camera
packet = binascii.unhexlify(&amp;quot;0000000a983b16f8f39c&amp;quot;)
s=socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.setsockopt(socket.SOL_SOCKET, socket.SO_BROADCAST, 1)
s.sendto(bytes(packet), dest)
&lt;/code&gt;&lt;/pre&gt;
">IP Camera BAT 310 Hacking</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2020-02-04-i-post-translate-idl-to-python/"" data-c="
          &lt;h2 id=&#34;idl-programming-language&#34;&gt;IDL programming language&lt;/h2&gt;
&lt;p&gt;IDL, short for Interactive Data Language, is a programming language used for data analysis. It is popular in particular areas of science, such as astronomy, atmospheric physics and medical imaging. (https://en.wikipedia.org/wiki/IDL_(programming_language))&lt;/p&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;idl-to-python-numpy-document&#34;&gt;IDL to python (numpy) document&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;(IDL to Numeric/numarray Mapping)[https://www.johnny-lin.com/cdat_tips/tips_array/idl2num.html]&lt;/li&gt;
&lt;li&gt;(NumPy for IDL users)[http://mathesaurus.sourceforge.net/idl-numpy.html]&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;idlwrap-api&#34;&gt;idlwrap API&lt;/h2&gt;
&lt;p&gt;idlwrap helps you port IDL code to python by providing an IDL-like interface to numpy and scipy.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;(API)[https://r4lv.github.io/idlwrap/api.html]&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;note&#34;&gt;Note&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Array
&lt;ul&gt;
&lt;li&gt;IDL a[i, *] is the same with Python a[:,i]&lt;br&gt;
There are two different ways of storing a matrix/array in memory: column-major and row-major.&lt;/li&gt;
&lt;li&gt;IDL array index include the last element:&lt;pre&gt;&lt;code class=&#34;language-IDL&#34;&gt;IDL&amp;gt; (FLTARR(10))[3:5]
 0.00000      0.00000      0.00000 ; -&amp;gt; three elements
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt;&amp;gt; np.zeros(10)[3:5]
array([0., 0.]) # -&amp;gt; two elements
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
">Translante IDL script to python</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2019-12-13-i-post-create-api-on-aws-lambda/"" data-c="
          &lt;h2 id=&#34;lambda-script&#34;&gt;Lambda script&lt;/h2&gt;
&lt;p&gt;Lambda could collect POST boday and url params using &lt;code&gt;event&lt;/code&gt; . For POST body, params could be extracted directly like &lt;code&gt;event[&#39;param1&#39;]&lt;/code&gt;.&lt;br&gt;
As of September 2017, you no longer have to configure mappings to access the request body.&lt;br&gt;
All you need to do is check, &amp;quot;Use Lambda Proxy integration&amp;quot;, under Integration Request, under the resource of AWS API Gateway.&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;You&#39;ll then be able to access query parameters, path parameters and headers like so&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;event[&#39;pathParameters&#39;][&#39;param1&#39;]
event[&amp;quot;queryStringParameters&amp;quot;][&#39;queryparam1&#39;]
event[&#39;requestContext&#39;][&#39;identity&#39;][&#39;userAgent&#39;]
event[&#39;requestContext&#39;][&#39;identity&#39;][&#39;sourceIP&#39;]
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For proxied API, the hander function should return the reponse in following format:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
    &amp;quot;isBase64Encoded&amp;quot;: true|false,
    &amp;quot;statusCode&amp;quot;: httpStatusCode,
    &amp;quot;headers&amp;quot;: { &amp;quot;headerName&amp;quot;: &amp;quot;headerValue&amp;quot;, ... },
    &amp;quot;body&amp;quot;: &amp;quot;...&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Usually, when you see Malformed Lambda proxy response, it means your response from your Lambda function doesn&#39;t match the format API Gateway is expecting.&lt;/p&gt;
">Parse URL params using API Gateway and lambda</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2019-12-10-i-post-add-image-layer-to-react-mapbox-gl/"" data-c="
          &lt;p&gt;Images could be added to mapbox using a &lt;code&gt;Layer&lt;/code&gt; and &lt;code&gt;Source&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;layer-configuration&#34;&gt;Layer configuration&lt;/h2&gt;
&lt;p&gt;Prepare a source configuration by referenceing (this document)[https://docs.mapbox.com/mapbox-gl-js/style-spec/#sources-image]&lt;/p&gt;
&lt;!-- more --&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;const Image_SOURCE_OPTIONS = {
    &amp;quot;type&amp;quot;: &amp;quot;image&amp;quot;,
    &amp;quot;url&amp;quot;: &amp;quot;https://docs.mapbox.com/mapbox-gl-js/assets/radar.gif&amp;quot;,
    &amp;quot;coordinates&amp;quot;: [
        [-80.425, 46.437],
        [-71.516, 46.437],
        [-71.516, 37.936],
        [-80.425, 37.936]
    ] 
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For base64 image, the url could be &lt;code&gt;data:image/png;base64,&lt;/code&gt; + base64 image data:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;const Image_SOURCE_OPTIONS = {
    &amp;quot;type&amp;quot;: &amp;quot;image&amp;quot;,
    &amp;quot;url&amp;quot;: &amp;quot;data:image/png;base64,...&amp;quot;,
    &amp;quot;coordinates&amp;quot;: [
        [-80.425, 46.437],
        [-71.516, 46.437],
        [-71.516, 37.936],
        [-80.425, 37.936]
    ] 
};
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;create-a-source&#34;&gt;Create a Source&lt;/h1&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;Source id=&amp;quot;source_id&amp;quot; tileJsonSource={RASTER_SOURCE_OPTIONS} /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;create-a-layer&#34;&gt;Create a Layer&lt;/h2&gt;
&lt;p&gt;Reference (react-mapbox-gl document)[https://github.com/alex3165/react-mapbox-gl/blob/master/docs/API.md#layer], the type could only be &lt;code&gt;symbol&lt;/code&gt;, &lt;code&gt;line&lt;/code&gt;, &lt;code&gt;raster&lt;/code&gt;, ...&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt; &amp;lt;Layer type=&amp;quot;raster&amp;quot; id=&amp;quot;layer_id&amp;quot; sourceId=&amp;quot;source_id&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
">Add an image layer to react mapbox gl</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2019-09-11-i-post-get-data-from-google-storage/"" data-c="
          &lt;h2 id=&#34;software&#34;&gt;Software&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Install gcloud with gsutil included&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;login-google-cloud-using-json-file&#34;&gt;Login google cloud using json file&lt;/h2&gt;
&lt;p&gt;document: https://cloud.google.com/sdk/gcloud/reference/auth/activate-service-account&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;gcloud auth activate-service-account test@test.iam.gserviceaccount.com --key-file=./secret.json

&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;copy-data&#34;&gt;Copy data&lt;/h2&gt;
&lt;p&gt;reference this document for detail: https://cloud.google.com/storage/docs/gsutil/commands/cp&lt;/p&gt;
&lt;p&gt;-copy bucket data to local&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;gsutil -m cp -r gs://my-bucket/data ./data
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;rsync-data&#34;&gt;rsync data&lt;/h2&gt;
&lt;p&gt;reference this document for detail: https://cloud.google.com/storage/docs/gsutil/commands/rsync&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;rsync local data from bucket&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;gsutil -m rsync -d -r gs://mybucket/data  ./data
&lt;/code&gt;&lt;/pre&gt;
">Copy data using google cloud gsutil</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2019-09-11-i-post-goaccess-analysis-k8s-nginx-log/"" data-c="
          &lt;h2 id=&#34;software&#34;&gt;Software&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;use this document to update goaccess to the latest version: https://goaccess.io/download&lt;/li&gt;
&lt;li&gt;use this document to find the suitable log format: https://github.com/allinurl/goaccess/blob/master/config/goaccess.conf&lt;/li&gt;
&lt;li&gt;install jq linux tool&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;analysis-k8s-nginx-log&#34;&gt;Analysis K8S nginx log&lt;/h2&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;find */* -type f  -exec jq &amp;quot;.textPayload&amp;quot; \{\} \; | goaccess --log-format=&#39;%^ %^ [%h] %^ %^ [%d:%t %^] \&amp;quot;%r\&amp;quot; %^ %b \&amp;quot;%R\&amp;quot; \&amp;quot;%u\&amp;quot; %^ %^ [%v] %^:%^ %^ %T %^ %^&#39; --date-format=%d/%b/%Y --time-format=%H:%M:%S - --with-output-resolver -o out.html
&lt;/code&gt;&lt;/pre&gt;
">GoAccess process K8S web log</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2019-06-07-install-owncloud-with-docker-and-local-directory/"" data-c="
          &lt;p&gt;I was struggled on installing owncloud barely on ubuntu 18, and spent hours on install and config its dependencies, but failed on database script execution.&lt;/p&gt;
&lt;p&gt;During googling to solve my problem, I noticed a dockerized owncloud, and find it&#39;s pretty easy to setup.&lt;/p&gt;
&lt;p&gt;Here is the installation/configuration log:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Install docker and docker-compose&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.docker.com/install/linux/docker-ce/ubuntu/&#34;&gt;docker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.docker.com/compose/install/&#34;&gt;docker-compose&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Prepare a docker-compose.yml&lt;/strong&gt; :&lt;/p&gt;
&lt;p&gt;Referenced  this &lt;a href=&#34;https://doc.owncloud.com/server/admin_manual/installation/docker/&#34;&gt;Installing with Docker&lt;/a&gt;&lt;br&gt;
and this &lt;a href=&#34;https://raw.githubusercontent.com/owncloud-docker/server/master/docker-compose.yml&#34;&gt;yml file&lt;/a&gt; to make my own docker-compose.yml file.&lt;/p&gt;
&lt;p&gt;Because I have a RDS instance on cloud, and a NAS storage mounted on this server, I was wondering to reuse them. So I removed the volumns and db dependencies from the yml file.&lt;br&gt;
Becuase this owncloud file sharing will be used by very few users, and the VM will have extra charge for CPU usage, I removed redis.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yml&#34;&gt;version: &#39;2.1&#39;

services:
  owncloud:
    image: owncloud/server:10.0
    restart: always
    ports:
      - 8080:8080
    environment:
      - OWNCLOUD_DOMAIN=localhost
      - OWNCLOUD_DB_TYPE=mysql
      - OWNCLOUD_DB_NAME=db_name
      - OWNCLOUD_DB_USERNAME=db_username
      - OWNCLOUD_DB_PASSWORD=db_password
      # db can be any remote url with accessing privilidge
      - OWNCLOUD_DB_HOST=db_url
      - OWNCLOUD_ADMIN_USERNAME=admin
      - OWNCLOUD_ADMIN_PASSWORD=admin
      # for owncloud &amp;gt;= 9.0, add this config to allow local directory as external storage
      - OWNCLOUD_ALLOW_EXTERNAL_LOCAL_STORAGE=true
    healthcheck:
      test: [&amp;quot;CMD&amp;quot;, &amp;quot;/usr/bin/healthcheck&amp;quot;]
      interval: 30s
      timeout: 10s
      retries: 5
    volumes:
      - /mnt/data/owncloud:/mnt/data
      - /other-directory1:/mnt/data/d1
      - /other-directory2:/mnt/data/d2

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Use command &lt;code&gt;sudo docker-compose up -d&lt;/code&gt; to start owncloud, and access it through &lt;code&gt;server_ip:8080&lt;/code&gt;.&lt;br&gt;
Please add port &lt;code&gt;8080&lt;/code&gt; to your VM&#39;s network route rule.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Add local storage&lt;/strong&gt; :&lt;/p&gt;
&lt;p&gt;Reference this &lt;a href=&#34;https://doc.owncloud.com/server/admin_manual/configuration/files/external_storage/local.html&#34;&gt;Local storage&lt;/a&gt; to add local directory.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;usefull notes&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;scan files copied to owncloud directory: &lt;code&gt;docker-compose exec owncloud occ files:scan --all&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
">Install owncloud with docker and local directory</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/2019-02-28-i-post-read-h264-livestream/"" data-c="
          &lt;p&gt;Got a Solar WiFi IP camera from &lt;a href=&#34;https://www.ebay.com.au/itm/302918525683?ul_noapp=true&#34;&gt;Wireless Solar IP67 Security Camera System Outdoor Home Cam 1080P 2MP&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Wondering to capture video or images from the camera using script/program.&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;&lt;code&gt;ffmpeg -re -i &amp;quot;http://host ip:81/livestream.cgi?user=admin&amp;amp;pwd=&amp;amp;streamid=0&amp;quot; -c copy -f mpegts test.mp4&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ffmpeg -i &amp;quot;http://host ip:81/livestream.cgi?user=admin&amp;amp;pwd=a123&amp;amp;streamid=0&amp;quot; -c copy -f mpegts -ss 5 -frames:v 5 testt.png&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;FFMPEG is not portable, another way of using cv2 to capture a picture:&lt;br&gt;
(ref &lt;a href=&#34;https://stackoverflow.com/questions/28477600/not-able-to-play-h264-video-on-opencv&#34;&gt;Not able to play .h264 video on OpenCV?&lt;/a&gt;)&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;cap = cv2.VideoCapture(&#39;http://host:81/livestream.cgi?user=admin&amp;amp;pwd=&amp;amp;streamid=0&#39;)
        while(cap.isOpened()):
            ret, frame = cap.read()
            # write to local file
            cv2.imwrite(&amp;quot;capture.png&amp;quot;,frame)
            # create memory file object save to AWS S3
            #img_data = io.BytesIO(cv2.imencode(&#39;.png&#39;, frame)[1])
            break
        cap.release()
&lt;/code&gt;&lt;/pre&gt;
">Read H264 livestream using ffmpeg and cv2</a>
      </div>
      
      <div class="item">
        <a class="result-title" style="opacity: 0;" href="https://jevy.wang/post/about-me/"" data-c="
          &lt;h1 id=&#34;jevy-wang&#34;&gt;Jevy Wang&lt;/h1&gt;
&lt;p&gt;#github:&lt;/p&gt;
&lt;h1 id=&#34;&#34;&gt;&lt;/h1&gt;
">About Me</a>
      </div>
      
    </div>
    <div class="page">
      <div id="page_ul"></div>
    </div>
  </div>
</div>
<script>
  !function () {
    let searchMask = document.querySelector('#search_mask');
    let result = document.querySelector('#result');
    let items = document.querySelectorAll('.item');
    let searchBox = document.querySelector('#search');
    let statCount = document.querySelector('#stat_count');
    let statTimes = document.querySelector('#stat_times');
    let pageUl = document.querySelector('#page_ul');
    let close = document.querySelector('#close');
    
    close.addEventListener('click', function() {
      searchMask.style = 'display: none;'
    })

    let finds = [];
    let contents = [];
    let pageSize = 10;
    items.forEach(item => {
      let a = item.querySelector('a');
      contents.push({
        title: a.innerText,
        details: a.dataset.c,
        link: a.href
      })
      item.remove();
    })

    function insertStr(soure, start, count) {
      let newStr = soure.substr(start, count);
      return soure.slice(0, start) + '<em>' + newStr + '</em>' + soure.slice(start + count);
    }

    pageUl.addEventListener('click', function(event) {
      let target = event.target;
      if (target.__proto__ === HTMLSpanElement.prototype) {
        appendResults(parseInt(target.dataset.i));
      }
    })

    function appendResults(index) {
      let htmlResult = '';
      let start = index || 0;
      let end = Math.min(start + pageSize, finds.length);
      for (let i = start; i < end; i++) {
        const current = finds[i];
        let html = current.title;
        let sum = 0;
        let positions = current.positions;
        positions.forEach(position => {
          html = insertStr(html, position.start + sum, position.count);
          sum += 9;
        })
        htmlResult += `<div class="item"><a class="result-title" href="${current.link}">${html}</a></div>`;
      }
      result.innerHTML = htmlResult;
      pageUl.innerHTML = '';
      let count = finds.length / pageSize;
      let lis = '';
      if (start !== 0) {
        lis += `<span class="fa fa-angle-left" data-i='${start - 1}'></span>`;
      }
      for (let i = 0; i < count; i++) {
        lis += `<span class='${i === start?'current':''}' data-i='${i}'>${i+1}</span>`;     
      }
      if (start+1 < count) {
        lis += `<span class="fa fa-angle-right" data-i='${start+1}'></span>`;  
      }
      pageUl.innerHTML = lis;
    }

    function search(delay) {
      let timer = null
      return function () {
        clearTimeout(timer)
        timer = setTimeout(() => {
          let start = Date.now();
          let segments = searchBox.value.split(' ').filter(c => c != '');
          if (segments.length <= 0) {
            return;
          }
          finds = [];
          let htmlResult = '';
          contents.forEach(content => {
            let title = content.title;
            let positions = [];
            let find = false;
            segments.forEach((segment) => {
              if (content.title.includes(segment)) {
                find = true;
                positions.push({
                  start: content.title.indexOf(segment),
                  count: segment.length
                })
              } else if (content.details.includes(segment)) {
                find = true;
              }
            });
            if (find) {
              finds.push({
                title: content.title,
                link: content.link,
                positions
              });
            }
          })
          appendResults(0);
          statCount.textContent = finds.length;
          statTimes.textContent = Date.now() - start;
        }, delay)
      }
    }
    searchBox.addEventListener('input', search(200));
  }()
</script>

<input hidden id="copy" />
<script>
  !function () {
    let times = document.querySelectorAll('.publish-time');
    for (let i = 0; i < times.length; i++) {
      let date = times[i].dataset.t;
      let time = Math.floor((new Date().getTime() - new Date(date).getTime()) / 1000);
      if (time < 60) {
        str = time + '秒之前';
      } else if (time < 3600) {
        str = Math.floor(time / 60) + '分钟之前';
      } else if (time >= 3600 && time < 86400) {
        str = Math.floor(time / 3600) + '小时之前';
      } else if (time >= 86400 && time < 259200) {
        str = Math.floor(time / 86400) + '天之前';
      } else {
        str = times[i].textContent;
      }
      times[i].textContent = str;
    }
  }();
</script>

<script>
  let language = 'en';
  if (language !== '') {
    let map = new Map();
    if (language === 'en') {
      map.set('search', 'Search');
      map.set('category', 'Categories');
      map.set('article', 'Articles');
      map.set('tag', 'Tags');
      map.set('top', 'Top');
      map.set('publish', 'published');
      map.set('minute', ' minutes');
      map.set('read-more', 'Read More');
      map.set('view', 'View');
      map.set('words', ' words');
      map.set('category-in', 'category in');
      map.set('preview', 'Meta');
      map.set('index', 'Toc');
      map.set('no-archives', "You haven't created yet");
      map.set('archives', " articles in total");
      map.set('cloud-tags', " tags in total");
      map.set('copyright', "Copyright: ");
      map.set('author', "Author: ");
      map.set('link', "Link: ");
      map.set('leave-message', "Leave a message");
      map.set('format', "Links Format");
      map.set('site-name', "Name: ");
      map.set('site-link', "Link: ");
      map.set('site-desc', "Desc: ");
      map.set('stat', " related results, taking ");
      map.set('stat-time', " ms");
      map.set('site-img', "Image: ");
    }

    if (map.size > 0) {
      let lanElems = document.querySelectorAll('.language');
      lanElems.forEach(elem => {
        let lan = elem.dataset.lan, text = map.get(lan);
        if (elem.__proto__ === HTMLInputElement.prototype) {
          elem.placeholder = text
        } else {
          if (elem.dataset.count) {
            text = elem.dataset.count + text;
          }
          elem.textContent = text;
        }
      })
    }
  }
  //拿来主义(真香)^_^，Clipboard 实现摘自掘金 https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // 判断是不是ios端
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //创建文本元素
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //选择内容
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //复制到剪贴板
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("复制错误！请手动复制！")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === '复制成功') {
        return;
      }
      e.srcElement.textContent = '复制成功';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === '复制成功') {
            elem.textContent = '复制代码'
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = '复制代码';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })

</script>
<script src="/media/js/motion.js"></script>


<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 200
  });
</script>





</html>